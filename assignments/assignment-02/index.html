<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Assignment 2 | GEOG 4046 Web GIS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="/css/cayman.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="/css/style.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MNMHZ6YTJV"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-MNMHZ6YTJV');</script>
  </head>
  <body>
    <section class="page-header">
      <div class="shadebox title-box">
        <h1 class="project-name"><a href="/">GEOG 4046</a></h1>
        <h2 class="project-tagline">An Introduction to Web GIS</h2>
        <div class="text-center">
          <a href="/">About</a> |
          <a href="/lessons">Lessons</a> |
          <a href="/assignments">Assignments</a>
        </div>
      </div>
    </section>
    <section class="main-menu">

    </section>

    <section class="main-content">
      <h1 class="text-center">Assignment 2</h1>
      <h2 class="text-center">DIY web service</h2>
      <p>Web services were introduced in the lessons as programs that allow communication between applications on the Internet, which in Web GIS usually means showing maps and data in a browser or app. In the previous assignment, roads, demographics, and basemap layers were “streamed” to our app via web services, and most of our assignments will pull data in this way. Today we will write the code to create our own web service from scratch.</p>

<p>To do this, we will need a web server to host our application and listen for requests from clients. We will use CodeSandbox.io as a free test environment.</p>

<p>The web service will perform a simple operation: find the distance between two points on Earth. The programming language we will use is JavaScript.</p>

<p>Lastly, we will create a webpage that lets users enter two locations and see the distance between them in kilometers, with our web service doing the calculation behind the scenes.</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#prep">Prep</a></li>
  <li><a href="#steps">Steps</a>
    <ul>
      <li><a href="#part-1-create-a-server-app">Part 1: Create a server app</a></li>
      <li><a href="#part-2-create-a-client-app">Part 2. Create a client app</a></li>
    </ul>
  </li>
  <li><a href="#try-it">Try It</a></li>
  <li><a href="#checklist">Checklist</a></li>
  <li><a href="#submit">Submit</a></li>
</ul>

<h2 id="prep">Prep</h2>
<p>Our distance calculator web service will need to be hosted on a web server, so first we will set up a server on CodeSandbox.</p>
<ol>
  <li>Go to <a href="https://codesandbox.io">https://codesandbox.io</a> and sign in with a Google or Github account.<br />
 </li>
  <li>Click “+ Create”, search for “Node HTTP Server”, and click its tile.<br />
<img src="../../assignment-resources/images/node-http-server.png" alt="Node HTTP server" /><br />
 </li>
  <li>Options will appear to configure the server.
    <ul>
      <li>Name: Distance Calc Server</li>
      <li>Visibility: Unlisted</li>
      <li>VM specs: Pico</li>
      <li>Click “Create Devbox”<br />
 </li>
    </ul>
  </li>
  <li>Once the server is created, you will see a workspace with three main panels:
    <ul>
      <li>Files - <code>index.js</code> is created by default as our main application file.</li>
      <li>Code - <code>index.js</code> contains some default JavaScript that we will modify.</li>
      <li>Preview - Your application’s output will be previewed here in an emulated browser.<br />
<img src="../../assignment-resources/images/csb-first-view.png" alt="CodeSandbox Node template" /><br />
 </li>
    </ul>
  </li>
  <li>Note your app URL, similar to <code>https://abc123-8080.csb.app</code>. You will use it later.</li>
</ol>

<h2 id="data">Data</h2>
<p>The data to calculate distance will be the latitude and longitude of two locations, Location A and Location B; for example, 30 degrees latitude and -90 longitude for New Orleans and 30.45 degrees latitude and -91.187 longitude for Baton Rouge.</p>

<p>Example data:</p>

<table>
  <thead>
    <tr>
      <th>Location</th>
      <th>Latitude</th>
      <th>Longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>A</td>
      <td>30.0</td>
      <td>-90.0</td>
    </tr>
    <tr>
      <td>B</td>
      <td>30.45</td>
      <td>-91.187</td>
    </tr>
  </tbody>
</table>

<h2 id="steps">Steps</h2>
<h3 id="part-1-create-a-server-app">Part 1: Create a server app</h3>
<ol>
  <li>Delete all default code in <code>index.js</code> and copy and paste the code below. Read the lines beginning with <code>//</code> for comments describing what the code does. You do not need to understand every bit of code here, just the general purpose of each part.
    <pre><code class="language-javascript">  var http = require("http");
  http
 .createServer(function (request, response) {
   // Read the URL used to contact the web service and extract the latitude and longitude values, saving them each to a variable
   var requestUrl = new URL("http://" + request.headers.host + request.url);
   var latA = requestUrl.searchParams.get("latA");
   var lonA = requestUrl.searchParams.get("lonA");
   var latB = requestUrl.searchParams.get("latB");
   var lonB = requestUrl.searchParams.get("lonB");

   // Use the spherical law of cosines formula to calculate distance in kilometers along the surface of a sphere. Source: https://www.movable-type.co.uk/scripts/latlong.html
   var φ1 = (latA * Math.PI) / 180;
   var φ2 = (latB * Math.PI) / 180;
   var Δλ = ((lonB - lonA) * Math.PI) / 180;
   var R = 6371; // Earth's radius in km
   var distance =
     Math.acos(
       Math.sin(φ1) * Math.sin(φ2) + Math.cos(φ1) * Math.cos(φ2) * Math.cos(Δλ)
     ) * R;

   // Output the calculated distance value to the client and complete the execution of the program.
   response.setHeader("Access-Control-Allow-Origin", "*");
   response.write('{"distance": ' + distance.toFixed(2) + '}');
   response.end();
 })
 .listen(8080);
</code></pre>
  </li>
  <li>Save <code>index.js</code> using the keyboard shortcut <code>Ctrl</code>+<code>S</code> (<code>Cmd</code>+<code>S</code> on Mac).</li>
  <li>Refresh the preview (not your web browser); it should output <code>{"distance": 0.00}</code> because we did not provide input in the URL.</li>
  <li>In the preview address bar, paste the following text to the end of your app URL and press Enter: <code>?latA=30&amp;lonA=-90&amp;latB=30.45&amp;lonB=-91.187</code>. This assigns values to the lat/lon parameters.
    <ul>
      <li><code>latA</code> = 30</li>
      <li><code>lonA</code> = -90</li>
      <li><code>latB</code> = 30.45</li>
      <li><code>lonB</code> = -91.187<br />
  Full URL example (replace <code>abc123</code> with your app’s ID):<br />
  <code>https://abc123-8080.csb.app?latA=30&amp;lonA=-90&amp;latB=30.45&amp;lonB=-91.187</code>.</li>
    </ul>
  </li>
  <li>The web service should now output <code>{"distance": 124.54}</code> because when you pressed Enter to preview the URL, the lat/lon values for a “point A” (New Orleans) and “point B” (Baton Rouge) were sent to your web service—the program you wrote to calculate distance.</li>
</ol>

<p>Your web service is now complete. Your server is listening at that URL for requests from other apps, ready to plug their input into the distance formula and output the result.</p>

<h3 id="part-2-create-a-client-app">Part 2: Create a client app</h3>
<p>Now let us make an app to put the web service to use. Your app will be a webpage that:</p>
<ul>
  <li>Lets users type in the lat/lon of two locations.</li>
  <li>Sends the lat/lon coordinates to your web service.</li>
  <li>Shows the web service output (distance in km) to the user.</li>
</ul>

<p>You will create another sandbox to host this webpage.</p>

<ol>
  <li>Follow the steps in the <a href="#prep">Prep</a> section again to create another sandbox, but this time search for “HTML + CSS” and configure with the following options:<br />
<img src="../../assignment-resources/images/html-css.png" alt="CSB HTML CSS" />
    <ul>
      <li>Name: Distance Calc Client</li>
      <li>Visibility: Unlisted</li>
      <li>Runtime: Sandbox</li>
      <li>Click “Create Sandbox”.</li>
    </ul>
  </li>
  <li>Once the sandbox is created, click <code>index.html</code> in the Files panel.</li>
  <li>
    <p>Delete the contents of <code>index.html</code> and replace with the code below, but again change <code>abc123</code> to the ID of your own web service app.</p>

    <pre><code class="language-html"> &lt;!DOCTYPE html&gt;
 &lt;html&gt;
   &lt;head&gt;
     &lt;title&gt;Distance Calculator&lt;/title&gt;
   &lt;/head&gt;
   &lt;body&gt;
     &lt;h2&gt;Enter latitude and longitude&lt;/h2&gt;
     Place A
     &lt;input type="text" id="latA" placeholder="Place A lat" /&gt;
     &lt;input type="text" id="lonA" placeholder="Place A lon" /&gt;
     &lt;hr /&gt;
     Place B
     &lt;input type="text" id="latB" placeholder="Place B lat" /&gt;
     &lt;input type="text" id="lonB" placeholder="Place B lon" /&gt;
     &lt;hr /&gt;
     &lt;input type="submit" id="submit" value="Calculate Distance (km)" /&gt;
     &lt;br /&gt;&lt;br /&gt;
     Distance (km):
     &lt;h1 id="output"&gt;0&lt;/h1&gt;
     &lt;script src="https://code.jquery.com/jquery-3.6.0.min.js"&gt;&lt;/script&gt;
     &lt;script&gt;
       $("#submit").click(function () {
         // Read the text input boxes to get the user's coordinates, add them to the URL to request the web service
         $.getJSON(
           "https://abc123-8080.csb.app",
           {
             latA: $("#latA").val(),
             lonA: $("#lonA").val(),
             latB: $("#latB").val(),
             lonB: $("#lonB").val()
           },
           // Receive the response from the web service, print the distance on the webpage
           function (data) {
             $("#output").html(data.distance);
           }
         );
       });
     &lt;/script&gt;
   &lt;/body&gt;
 &lt;/html&gt;
</code></pre>
    <p>This code is a mix of HTML and JavaScript to build a user interface.</p>
  </li>
  <li>Save <code>index.html</code> using the shortcut <code>Ctrl</code>+<code>S</code> (<code>Cmd</code>+<code>S</code> on Mac). You might have to refresh the preview.</li>
  <li>Use the same lat/lon test values from Part 1 (30,-90 and 30.45,-91.187) and click the button to submit the form. It should print the distance value on the page.</li>
  <li>Click the “Share” button in CodeSandbox and copy the “Share URL”. You will submit this URL to complete the assignment.</li>
  <li>Test your URL in an <a href="https://support.google.com/chrome/answer/95464">incognito window</a> to make sure it works.</li>
</ol>

<h2 id="try-it">Try it</h2>

<h3 id="test-and-document">Test and document</h3>
<ol>
  <li>Use <a href="https://www.google.com/maps">Google Maps</a> to get the latitude and longitude of two locations of your choosing by right-clicking the map to copy the coordinates at each place you choose.</li>
  <li>On your client app webpage, enter the new coordinate values into the form and observe the new distance value. Roughly verify the accuracy using the Measure Distance tool in Google Maps.</li>
  <li>At the top of your server app code, on Line 1, insert a new comment. Give the following in the comment:
    <ul>
      <li>One or two sentences describing what your program does, expected input, and expected output.</li>
      <li>The names of the locations you used for your test coordinates (e.g., “the southwestern corner of Howe-Russell”, or “Beijing”).</li>
      <li>The output distance of your test.</li>
      <li>The comment should look similar to the screenshot below.<br />
<img src="../../assignment-resources/images/csb-comment.png" alt="Screenshot of a JavaScript comment" /></li>
    </ul>
  </li>
</ol>

<h2 id="checklist">Checklist</h2>
<ol>
  <li>A “Node HTTP Server” sandbox (your server app; see Part 1). It should accept lat/lon inputs, calculate the distance between them, and output the distance.</li>
  <li>An “HTML + CSS” sandbox (your client app; see Part 2). It should include a form that sends a request to your web service sandbox. It should print the response somewhere on the webpage.</li>
  <li>A comment in the server app explaining what it does, the input you tested, and the expected output (see Try It).</li>
  <li>The URL to the client app sandbox.</li>
</ol>

<h2 id="submit">Submit</h2>
<p>Submit the URL to your “HTML + CSS” client app sandbox, copied in Part 2 Step 6.</p>

<p>The URL to your “HTML + CSS” sandbox should look like:<br />
<code>https://codesandbox.io/p/sandbox/yourappid</code></p>

      <br><br>
      <a href="#top">&uarr; Top</a><br>
      <a href="../../assignments/">&larr; Back to Assignments</a>
    </section>
<footer class="site-footer">
  <small>&nbsp;&copy; All rights reserved.</small>
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
<script src="/js/prism.js"></script>
<script src="/js/custom.js"></script>
</body>
</html>

